import{m as $,u as D,a as W,n as q,b as U,r as o,o as M,R as y,j as e,F as z,d as G,e as S,p as V,G as n,S as c,I as b,O as v,f as u,g as H,h as K,E as N,i as J,q as Q,t as X,T as k,v as Y,L as Z,A as _,B as ee,k as se,w as te,x as ae}from"./index-Qyp0YfP3.js";const ne=$(a=>({options:{position:"fixed",top:a.spacing(1),right:a.spacing(1)},container:{display:"flex",flexDirection:"column",gap:a.spacing(2)},extraContainer:{display:"flex",gap:a.spacing(2)},registerButton:{minWidth:"unset"},resetPassword:{cursor:"pointer",textAlign:"center",marginTop:a.spacing(2)}})),de=()=>{ne();const a=D(),C=W();q(),U();const[ie,m]=o.useState(!1);M("loginEmail","");const[re,P]=o.useState(""),[h,oe]=o.useState(""),[E,x]=o.useState(!1),[w,g]=o.useState(!1),[A,j]=o.useState(""),R=async()=>{if(te){let s="";try{const i=dayjs().add(6,"months").toISOString(),r=await fetch("/api/session/token",{method:"POST",body:new URLSearchParams(`expiration=${i}`)});r.ok&&(s=await r.text())}catch{s=""}ae(`login|${s}`)}},[T,F]=y.useState(!1),[p,I]=y.useState(!1),L=()=>{I(!p)},O=s=>{s.preventDefault()};return e.jsx(e.Fragment,{children:e.jsx(z,{initialValues:{email:"",password:"",submit:null},validationSchema:G().shape({email:S().email("Must be a valid email").max(255).required("Email is required"),password:S().max(255).required("Password is required")}),onSubmit:async(s,{setErrors:i,setStatus:r,setSubmitting:f})=>{event.preventDefault(),m(!1);try{const l=`email=${encodeURIComponent(s.email)}&password=${encodeURIComponent(s.password)}`,t=await fetch("/api/session",{method:"POST",body:new URLSearchParams(h.length?l+`&code=${h}`:l)});if(t.ok){const d=await t.json();R(),a(V.updateUser(d)),C("/")}else t.status===401&&t.headers.get("WWW-Authenticate")==="TOTP"?setCodeEnabled(!0):t.status==400?(j(await t.text()),g(!0),x(!0)):(j(await t.text()),g(!0),x(!1))}catch{m(!0),P("")}},children:({errors:s,handleBlur:i,handleChange:r,handleSubmit:f,isSubmitting:l,touched:t,values:d})=>e.jsx("form",{noValidate:!0,onSubmit:f,autoComplete:"new-password",children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,children:e.jsxs(c,{spacing:1,children:[e.jsx(b,{htmlFor:"email-login",children:"Email Address"}),e.jsx(v,{id:"email-login",type:"email",value:d.email,name:"email",onBlur:i,onChange:r,placeholder:"Enter email address",fullWidth:!0,autoComplete:"new-password",autoFocus:!0,error:!!(t.email&&s.email)}),t.email&&s.email&&e.jsx(u,{error:!0,id:"standard-weight-helper-text-email-login",children:s.email})]})}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(c,{spacing:1,children:[e.jsx(b,{htmlFor:"password-login",children:"Password"}),e.jsx(v,{fullWidth:!0,error:!!(t.password&&s.password),id:"-password-login",type:p?"text":"password",value:d.password,name:"password",autoComplete:"new-password",onBlur:i,onChange:r,endAdornment:e.jsx(H,{position:"end",children:e.jsx(K,{"aria-label":"toggle password visibility",onClick:L,onMouseDown:O,edge:"end",size:"large",children:p?e.jsx(N,{}):e.jsx(J,{})})}),placeholder:"Enter password"}),t.password&&s.password&&e.jsx(u,{error:!0,id:"standard-weight-helper-text-password-login",children:s.password})]})}),e.jsx(n,{item:!0,xs:12,sx:{mt:-1},children:e.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,children:[e.jsx(Q,{control:e.jsx(X,{checked:T,onChange:B=>F(B.target.checked),name:"checked",color:"primary",size:"small"}),label:e.jsx(k,{variant:"h6",children:"Keep me sign in"})}),e.jsx(Y,{variant:"h6",component:Z,to:"",color:"text.primary",children:"Forgot Password?"})]})}),s.submit&&e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{error:!0,children:s.submit})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(ee,{disableElevation:!0,disabled:l,fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"primary",children:"Login"})})}),w&&e.jsx(n,{item:!0,xs:12,children:e.jsx(c,{sx:{width:"100%"},spacing:2,children:e.jsxs(se,{open:w,variant:"outlined",severity:"error",children:[A,E&&e.jsxs(k,{variant:"body1",sx:{textDecoration:"none"},color:"primary",children:["Check your email or"," ",e.jsx("a",{id:"anchor",href:"/email-verify",children:"Resend verification code"})]})]})})})]})})})})};export{de as A};
